<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>系统移植实操 | miaobuyi</title><meta name="author" content="miaobuyi"><meta name="copyright" content="miaobuyi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="gcc  binutils&#x2F;&#x2F;-----main.c#include &lt;stdio.h&gt;#define MY_NAME &quot;yzg --- &quot;void main(){    int *p;        p&#x3D;NULL;    *p &#x3D; 0x33;    printf(&quot;hello world \n&quot;);    printf(&quot;my name is %s \n&quot;,MY_NAME);}&#x2F;&#x2F;-">
<meta property="og:type" content="article">
<meta property="og:title" content="系统移植实操">
<meta property="og:url" content="https://miaobuyi.github.io/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E5%AE%9E%E6%93%8D/index.html">
<meta property="og:site_name" content="miaobuyi">
<meta property="og:description" content="gcc  binutils&#x2F;&#x2F;-----main.c#include &lt;stdio.h&gt;#define MY_NAME &quot;yzg --- &quot;void main(){    int *p;        p&#x3D;NULL;    *p &#x3D; 0x33;    printf(&quot;hello world \n&quot;);    printf(&quot;my name is %s \n&quot;,MY_NAME);}&#x2F;&#x2F;-">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imgapi.xl0408.top/index.php">
<meta property="article:published_time" content="2023-05-29T11:40:16.000Z">
<meta property="article:modified_time" content="2023-06-01T08:40:18.020Z">
<meta property="article:author" content="miaobuyi">
<meta property="article:tag" content="学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imgapi.xl0408.top/index.php"><link rel="shortcut icon" href="https://typora-1307795383.cos.ap-chengdu.myqcloud.com/avatar.jpg"><link rel="canonical" href="https://miaobuyi.github.io/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E5%AE%9E%E6%93%8D/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '系统移植实操',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-01 16:40:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/cursor.css"><link rel="stylesheet" href="/css/font.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://typora-1307795383.cos.ap-chengdu.myqcloud.com/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://imgapi.xl0408.top/index.php')"><nav id="nav"><span id="blog-info"><a href="/" title="miaobuyi"><span class="site-name">miaobuyi</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">系统移植实操</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-29T11:40:16.000Z" title="发表于 2023-05-29 19:40:16">2023-05-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-01T08:40:18.020Z" title="更新于 2023-06-01 16:40:18">2023-06-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="系统移植实操"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">gcc  binutils</span><br><span class="line"><span class="comment">//-----main.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MY_NAME <span class="string">"yzg --- "</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> *p;</span><br><span class="line">    </span><br><span class="line">    p=<span class="literal">NULL</span>;</span><br><span class="line">    *p = <span class="number">0x33</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"hello world \n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"my name is %s \n"</span>,MY_NAME);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//-----------------for gcc -E -S -c     </span></span><br><span class="line">$ gcc -E main.c &gt; main.pre</span><br><span class="line">$ vim main.pre  <span class="comment">//停在预编译阶段</span></span><br><span class="line">$ gcc -S main.c  <span class="comment">//停在编译阶段</span></span><br><span class="line">$ vim main.s     </span><br><span class="line">$ gcc -c main.c  <span class="comment">// for main.o  停在汇编阶段</span></span><br><span class="line">$ nm main.o </span><br><span class="line">$ gcc -v main.c <span class="comment">//for a.out  显示详细的编译过程信息</span></span><br><span class="line">$ nm a.out</span><br><span class="line">$ </span><br><span class="line"><span class="comment">//-----------------for nm strip </span></span><br><span class="line">$ gcc main.c  </span><br><span class="line">$ ls -l a.out</span><br><span class="line">$ file a.out  <span class="comment">//查看文件的信息</span></span><br><span class="line">$ nm a.out    <span class="comment">// 查看目标文件中的符号</span></span><br><span class="line">$ strip a.out <span class="comment">//去掉执行文件中的符号信息</span></span><br><span class="line">$ nm a.out   <span class="comment">//列出目标文件中的符号</span></span><br><span class="line">$ ls -l a.out</span><br><span class="line">$ file a.out</span><br><span class="line">$ </span><br><span class="line"><span class="comment">//------------------for addr2line ,null pointer</span></span><br><span class="line">$ </span><br><span class="line">$ gcc -g main.c</span><br><span class="line">$ ./a.out</span><br><span class="line">$ dmesg   <span class="comment">//查看内核打印的出错信息</span></span><br><span class="line">[<span class="number">63321.743235</span>] a.out[<span class="number">10662</span>]: segfault at <span class="number">0</span> ip <span class="number">08048409</span> sp bfd30050 error <span class="number">6</span> in a.out[<span class="number">8048000</span>+<span class="number">1000</span>]  </span><br><span class="line">$ addr2line <span class="number">08048409</span> -e a.out  -f  <span class="comment">//通过出错的地址找到对应代码的位置</span></span><br><span class="line">  main                                                  </span><br><span class="line">  /root/linux<span class="number">-2.6</span><span class="number">.35</span>-farsight/example/env/hello/main.c:<span class="number">9</span>         </span><br><span class="line">$ vim main.c </span><br><span class="line"> :<span class="built_in">set</span> number  <span class="comment">//显示行号</span></span><br><span class="line"></span><br><span class="line">$ objdump -d a.out <span class="comment">//查看反汇编代码</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="系统移植"><a href="#系统移植" class="headerlink" title="系统移植"></a>系统移植</h1><h3 id="linux系统：引导程序（BootLoader）、内核（kernel）-设备树-dtb-、根文件系统（rootfs）"><a href="#linux系统：引导程序（BootLoader）、内核（kernel）-设备树-dtb-、根文件系统（rootfs）" class="headerlink" title="linux系统：引导程序（BootLoader）、内核（kernel）+ 设备树(dtb)、根文件系统（rootfs）"></a>linux系统：引导程序（BootLoader）、内核（kernel）+ 设备树(dtb)、根文件系统（rootfs）</h3><p>【目标机】：开发板<br>【开发主机】：虚拟机<br>【宿主机】：pc机</p>
<h3 id="linux和window间共享"><a href="#linux和window间共享" class="headerlink" title="linux和window间共享"></a>linux和window间共享</h3><p>虚拟机 -&gt; 设置 -&gt; 选项 -&gt; 共享文件夹 -&gt; 添加 -&gt; 选择需要共享的位置（如E盘）<br>$ ls /mnt/hgfs/E/  //有共享的内容显示，表示成功</p>
<p>如果/mnt/hgfs下没有共享目录，则重新安装VMware tools工具，安装方法参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/love20165104027/article/details/83377758">https://blog.csdn.net/love20165104027/article/details/83377758</a><br>}</p>
<h3 id="网络的建立"><a href="#网络的建立" class="headerlink" title="网络的建立"></a>网络的建立</h3><p>设置【开发主机】的IP地址：也就是虚拟机的ip地址 192.168.9.120；</p>
<h4 id="确认电脑和虚拟机时能通信"><a href="#确认电脑和虚拟机时能通信" class="headerlink" title="确认电脑和虚拟机时能通信"></a>确认电脑和虚拟机时能通信</h4><p>编辑 -&gt; 虚拟网络编辑器  -&gt;  VMnet0 桥接到（选连板子的网卡） //注意不要用automic，应手动指定对应的网卡<br>虚拟机 -&gt; 设置 -&gt; 网卡适配器  -&gt; 自定义 (选 VMnet0)    /*使虚拟机内的虚拟网卡，关联到电脑实际用到的网卡<br>通过选VMnet0 和 VMnet1 。实现连板子，还是上internet的切换<br>点ubuntu右上角网络图标 -&gt; 右键选编辑连接 -&gt; 全删掉 -&gt; 添加（改新连接名称为board)<br>-&gt; IPV4 设置 -&gt; 方法（选手动） -&gt; 点添加 设置为 192.168.9.120 255.255.255.0 192.168.9.1 并保存退出<br>点右上角网络图标，先断开,再选board连接  // 通过选board,和internet 实现连板子，还是上internet的切换</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">ifconfig //看ip是否已变为了192.168.9.120</span><br><span class="line">ping 192.168.9.100  //测试电脑和虚拟机是否联通 （如不通，可尝试修复一下网卡，重启虚拟机）   </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h4 id="设置【宿主机】的IP地址：也就是pc机的ip地址-192-168-9-100-；"><a href="#设置【宿主机】的IP地址：也就是pc机的ip地址-192-168-9-100-；" class="headerlink" title="设置【宿主机】的IP地址：也就是pc机的ip地址 192.168.9.100 ；"></a>设置【宿主机】的IP地址：也就是pc机的ip地址 192.168.9.100 ；</h4><p>打开windows网络与共享中心–&gt;本地连接–&gt;属性–&gt;IPV4地址配置–&gt;配置IP；192.168.9.100设置【目标机】的ip地址：<br>启动开发板</p>
<blockquote>
<p>printenv（pri）： 输出当前环境信息；<br>setenv（set）：设置环境变量；<br>saveenv（save）：保存环境变量；</p>
<p>set ipaddr 192.168.9.233//设置【目标机】开发板的ip地址；<br>set serverip 192.168.9.120//设置【开发主机】ubuntu的ip地址；<br>set gatewayip 192.168.9.1//设置网关<br>set netmask 255.255.255.0//设置子网掩码<br>saveenv//保存环境变量到emmc中；</p>
</blockquote>
<blockquote>
<p>注意：<br>保证开发主机和目标机在同一个网段；<br>设置的serverip要与开发主机的ip地址保持一致；<br>设置完成需要对数据进行保存，否则断电数据丢失；</p>
</blockquote>
<h4 id="确认是否建立好网络通信："><a href="#确认是否建立好网络通信：" class="headerlink" title="确认是否建立好网络通信："></a>确认是否建立好网络通信：</h4><p>在目标机上通过ping命令检测</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">ping 192.168.9.120</span><br></pre></td></tr></tbody></table></figure>

<p>出现的结果：</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">ping failed; host 192.168.9.120 is not alive</span><br></pre></td></tr></tbody></table></figure>

<p>说明网络未连通；<br>分析错误原因：</p>
<blockquote>
<p>a. 检测网线是否连通；<br>b. 检测参数是否都正确；<br>c. 检测serverip是否和开发主机的ip一致;<br>d. 检测开发主机和宿主机是否桥接的是有线网卡；</p>
</blockquote>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">host 192.168.9.120 is alive</span><br></pre></td></tr></tbody></table></figure>


<p>说明网络连通；</p>
<h3 id="文件的传输"><a href="#文件的传输" class="headerlink" title="文件的传输"></a>文件的传输</h3><p>tftp服务来传输文件<br>【开发主机】建立tftp服务器：<br>检查是否安装过tftp</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-cache policy tftpd-hpa</span><br></pre></td></tr></tbody></table></figure>

<p>安装tftp服务器：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get install tftpd-hpa tftp-hpa</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意：虚拟机需要连外网，也就是能够ping <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> </p>
</blockquote>
<h4 id="配置tftp服务器"><a href="#配置tftp服务器" class="headerlink" title="配置tftp服务器"></a>配置tftp服务器</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sudo vim /etc/default/tftpd-hpa</span><br><span class="line">TFTP_USERNAME=<span class="string">"tftp"</span><span class="comment">#用户的使用命令；</span></span><br><span class="line">TFTP_DIRECTORY=<span class="string">"/tftpboot"</span><span class="comment">#共享文件的路径；</span></span><br><span class="line">TFTP_ADDRESS=<span class="string">"0.0.0.0:69"</span><span class="comment">#服务器的ip地址和端口号；</span></span><br><span class="line">TFTP_OPTIONS=<span class="string">"-l -c -s"</span></span><br><span class="line">根文件系统下面创建目录tftpboot,修改共享文件的权限</span><br><span class="line">sudo <span class="built_in">chmod</span> 0777 /tftpboot</span><br></pre></td></tr></tbody></table></figure>

<h4 id="启动tftp服务器"><a href="#启动tftp服务器" class="headerlink" title="启动tftp服务器"></a>启动tftp服务器</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sudo service tftpd-hpa restart//重启</span><br></pre></td></tr></tbody></table></figure>

<p>将需要传输的文件存储在共享目录中(/tftpboot)</p>
<p>测试是否成功安装</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">tftp 127.0.0.1    </span><br><span class="line">tftp&gt;get &lt;filename&gt;    </span><br><span class="line">tftp&gt;q</span><br></pre></td></tr></tbody></table></figure>

<h4 id="【目标机】下载文件"><a href="#【目标机】下载文件" class="headerlink" title="【目标机】下载文件"></a>【目标机】下载文件</h4><p>把day1的镜像目录下的uImage，exynos4412-fs4412.dtb，ramdisk.img拷贝到/tftpboot目录下</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">tftp 41000000 uImage//下载内核</span><br><span class="line">tftp 42000000 exynos4412-fs4412.dtb//下载设备树</span><br><span class="line">tftp 43000000 ramdisk.img//下载根文件系统</span><br><span class="line">bootm 41000000 43000000 42000000</span><br></pre></td></tr></tbody></table></figure>

<p> 内核地址根文件系统地址设备树地址<br>注意：地址顺序不能出错；  </p>
<p>验证：当板子重启时，不能重新运行系统；<br>解决：设置启动参数</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> bootcmd tftp 41000000 uImage\; tftp 42000000 exynos4412-fs4412.dtb\;tftp 43000000 ramdisk.img\; bootm 41000000 43000000 42000000</span><br><span class="line">boot</span><br></pre></td></tr></tbody></table></figure>

<h3 id="交叉编译器安装"><a href="#交叉编译器安装" class="headerlink" title="交叉编译器安装"></a>交叉编译器安装</h3><ol>
<li>将gcc-4.6.4.tar.xz 拷贝到虚拟机的某一个目录中<br>cp gcc-4.6.4.tar.xz ~/workspace/fs4412</li>
<li>进入到所对应的目录中，解压gcc-4.6.4.tar.xz<br>cd ~/workspace/fs4412<br>tar -xvf gcc-4.6.4.tar.xz</li>
<li>进入到gcc-4.6.4目录中，通过pwd查看绝对路径；<br>cd gcc-4.6.4/bin<br>pwd   === &gt; /home/farsight/workspace/fs4412/gcc-4.6.4/bin</li>
<li>修改PATH的值；<br>进入到/etc/bash.bashrc,在文件的最前面添加<br>sudo vim /etc/bash.bashrc<br>export PATH=$PATH:/home/farsight/workspace/fs4412/gcc-4.6.4/bin</li>
<li>重启；<br>source /etc/bash.bashrc</li>
</ol>
<p>arm-nTAB键==》 </p>
<p>6.测试：<br>a.生成可执行文件：arm-none-linux-guneabi-gcc 1.c<br>b.拷贝执行文件到下载目录: cp a.out /tftpboot<br>c.在板子上使用tftp下载a.out到板子上： tftp -g -r a.out 192.168.9.120 （注：板子和Ubuntu必须在同一网段）<br>注：使用tftp上传文件到服务器 tftp -p -r a.out 192.168.9.120<br>d.修改a.out权限：chmod 777 a.out<br>e.执行a.out: ./a.out<br>}</p>
<h3 id="nfs挂载文件"><a href="#nfs挂载文件" class="headerlink" title="nfs挂载文件"></a>nfs挂载文件</h3><h4 id="【开发主机】"><a href="#【开发主机】" class="headerlink" title="【开发主机】"></a>【开发主机】</h4><ol start="0">
<li>查看是否安装过nfs服务器：<br>sudo apt-cache policy nfs-kernel-server</li>
<li>安装nfs服务器<br>sudo apt-get install nfs-kernel-server</li>
<li>配置nfs服务器</li>
</ol>
<ol>
<li><p>拷贝day1镜像目录下的根文件系统rootfs.tar.xz到开发主机中的一个目录（例如/source/nfs）<br>cp rootfs.tar.xz /source/nfs</p>
</li>
<li><p>进入到rootfs.tar.xz所对应的目录中<br>cd /source/nfs</p>
</li>
<li><p>解压根文件系统<br>tar -xvf rootfs.tar.xz</p>
</li>
<li><p>进入到rootfs目录，使用pwd确定所对应的绝对路径<br>cd rootfs<br>pwd  —-&gt; /source/nfs/rootfs   就是用来挂载的共享路径；</p>
</li>
<li><p>修改nfs配置文件 sudo vim  /etc/exports<br>在文件的尾部添加代码：<br>/source/nfs/rootfs  *(rw,sync,no_root_squash,no_subtree_check)<br>注意：路径需要和根文件系统的实际路径一致；</p>
</li>
</ol>
<ol start="3">
<li><p>启动nfs服务器：<br>sudo service nfs-kernel-server restart</p>
</li>
<li><p>测试是否配置成功<br>sudo mount -t nfs localhost:/source/nfs/rootfs/  /mnt/  //测试nfs服务是否安装成功。<br>ls /mnt/  /*如果其中的内容和/nfs/rootfs中一致。 表示有挂载成功<br>如显示下面内容，表示成功<br>bin  dev  etc  lib  linuxrc  mnt  proc  root  sbin  sys  tmp  usr  var<br> */<br> sudo umount /mnt   //解除挂载</p>
</li>
</ol>
<h4 id="【目标机】"><a href="#【目标机】" class="headerlink" title="【目标机】"></a>【目标机】</h4><p>设置启动参数：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> bootcmd tftp 41000000 uImage\; tftp 42000000 exynos4412-fs4412.dtb\; bootm 41000000 - 42000000</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> bootargs root=/dev/nfs nfsroot=192.168.12.130:/source/nfs/rootfs rw console=ttySAC2,115200 init=/linuxrc ip=192.168.12.133 clk_ignore_unused=<span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>第一个ip地址是服务器ip地址，第二个ip地址是板子ip地址</p>
<p>set之后需要保存 <code>save</code>不然只生效一次，关机消失</p>
</blockquote>
<p>2、开发板重新启动: 开发板自动进入 下面界面<br>[root@farsight ]#   — 成功</p>
<p>把文件放入虚拟机中Linux的共享目录/source/nfs/rootfs中，开发板中自然会出现这个文件<br>在虚拟机中 cp  a.out  /source/nfs/rootfs<br>开发板中出现下面界面：</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">[root@farsight ]<span class="comment"># ls</span></span><br><span class="line">1.c      bin      etc      linuxrc  proc     sbin     tmp      var</span><br><span class="line">a.out    dev      lib      mnt      root     sys      usr</span><br></pre></td></tr></tbody></table></figure>

<h4 id="【问题解决】"><a href="#【问题解决】" class="headerlink" title="【问题解决】"></a>【问题解决】</h4><p>nfs本机测试没问题，但是挂载到开发板失败</p>
<p>方法一：如果ubuntu是18.04<br>Ubuntu 18.04 nfs 默认为协议3和协议4，但是 我的uboot 默认启动的是协议2的形式<br>如:  /srv/homes    hostname1(rw,sync,no_subtree_check)<br>若想要求 nfs 支持协议2，就在/etc/default/nfs-kernel-server末尾加一句：<br>RPCNFSDOPTS=”–nfs-version 2,3,4 –debug –syslog”</p>
<p>方法二：如果ubuntu是20.04<br>1）把nfs配置文件备份<br>sudo mv /etc/default/nfs-kernel-server  /etc/default/nfs-kernel-server.back</p>
<ol start="2">
<li>替换nfs配置文件<br> 把day1镜像目录下的nfs-kernel-server拷贝到/etc/default目录下</li>
</ol>
  <figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> nfs-kernel-server  /etc/default</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>重启nfs服务</li>
</ol>
  <figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">sudo service nfs-kernel-server restart</span><br></pre></td></tr></tbody></table></figure>

<ol start="4">
<li>重新挂载到开发板</li>
</ol>
<p>方法三：如果是ubuntu22.04</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/a_qwq_a/article/details/130651360">https://blog.csdn.net/a_qwq_a/article/details/130651360</a></p>
<p>【把内核设备树根文件系统烧写到EMMC上，直接启动】</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#a)拷贝第一天/镜像文件/ramdisk.img拷贝到虚拟机/tftpboot目录下</span></span><br><span class="line"><span class="comment">#b)烧写内核镜像到EMMC上</span></span><br><span class="line"></span><br><span class="line">tftp 41000000 uImage</span><br><span class="line"></span><br><span class="line">movi  write  kernel  41000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#c)烧写设备树文件到EMMC上</span></span><br><span class="line"></span><br><span class="line">tftp  41000000 exynos4412-fs4412.dtb</span><br><span class="line"></span><br><span class="line">movi  write  dtb  41000000=</span><br><span class="line"></span><br><span class="line"><span class="comment">#d)烧写文件系统镜像到EMMC上</span></span><br><span class="line"></span><br><span class="line">tftp  41000000  ramdisk.img</span><br><span class="line"></span><br><span class="line"><span class="comment">#movi  write  rootfs  41000000  3000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#e)设置启动参数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> bootcmd movi <span class="built_in">read</span> kernel 41000000\;movi <span class="built_in">read</span> dtb 42000000\;movi <span class="built_in">read</span> rootfs 43000000 3000000\;bootm 41000000 43000000 42000000</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> bootargs</span><br><span class="line"></span><br><span class="line">saveenv</span><br><span class="line"></span><br><span class="line"><span class="comment">#f)重新启动开发板，u-boot自动加载、执行内核</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="BootLoader-移植"><a href="#BootLoader-移植" class="headerlink" title="BootLoader 移植"></a>BootLoader 移植</h3><h4 id="【移植方法】"><a href="#【移植方法】" class="headerlink" title="【移植方法】"></a>【移植方法】</h4><ol>
<li>善用Beyond来对比两个文件</li>
<li>选择官方源码版本，配置编译<ol>
<li>指定交叉编译工具链</li>
<li>指定cpu和board（参考最类似的配置origen）</li>
<li>编译</li>
</ol>
</li>
<li>实现串口信息输出<ol>
<li>跟踪运行路径（led点灯法）</li>
<li>串口输出（检查uart初始化相关代码部分，见lowlevel_init.s）</li>
</ol>
</li>
<li>网卡移植（实现能用tftp nfs方便调试开发）<ol>
<li>寄存器地址</li>
<li>参数设置</li>
</ol>
</li>
<li>FLASH移植（实现能下载软件到FLASH，产品能离线运行）</li>
</ol>
<h4 id="【目的】"><a href="#【目的】" class="headerlink" title="【目的】"></a>【目的】</h4><p>移植uboot使kernel能够正常启动起来</p>
<h4 id="【准备资料】"><a href="#【准备资料】" class="headerlink" title="【准备资料】"></a>【准备资料】</h4><p>原理图、芯片手册、参考代码</p>
<h4 id="【分析】"><a href="#【分析】" class="headerlink" title="【分析】"></a>【分析】</h4><p>架构：</p>
<ol>
<li>确认芯片的架构：ARMv7</li>
<li>uboot中是否支持ARM架构：arch/arm/cpu/armv7/<br>NO: 1) 找老大要； 2)找芯片厂商； 3) 找百度……<br>YES : goto</li>
</ol>
<p>板子：</p>
<ol>
<li>确认板子信息：fs4412</li>
<li>uboot中是否支持fs4412板子； board<br>NO :1) 找老大要; 2)找芯片厂商； 3) 找百度…… 4) 借鉴(我们这个板子，借鉴的是 board/samsung/origen/)<br>YES : goto</li>
</ol>
<p>【移植】</p>
<ol start="0">
<li><p>准备工作：</p>
<ol>
<li><p>a、需要下载uboot：u-boot-2013.01.tar.bz2</p>
</li>
<li><p>b、拷贝u-boot到家目录下的某一个目录中；cp u-boot-2013.01.tar.bz2  ~/workspace/fs4412</p>
</li>
<li><p>进入到目录中，解压uboot并进入u-boot目录中；</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/workspace/fs4412</span><br><span class="line">tar xf u-boot-2013.01.tar.bz2</span><br><span class="line"><span class="built_in">cd</span> u-boot-2013.01</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
<li><p>借鉴origen板子的信息；  </p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">find . -name origen*</span><br><span class="line"><span class="comment">#拷贝板子头文件信息：</span></span><br><span class="line"><span class="built_in">cp</span> include/configs/origen.h include/configs/fs4412.h</span><br><span class="line"><span class="comment">#拷贝并且修改板级文件：</span></span><br><span class="line"><span class="built_in">cp</span> board/samsung/origen/ board/samsung/fs4412 -afr</span><br><span class="line"><span class="built_in">mv</span> board/samsung/fs4412/origen.c board/samsung/fs4412/fs4412.c</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<p>修改board/samsung/fs4412/Makefile的目标文件:<br>vim board/samsung/fs4412/Makefile<br>将 31行 的 origen.o 修改为 fs4412.o</p>
<p>修改u-boot目录下板级配置文件 boards.cfg<br>在origen后面添加新行</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">40 <span class="comment"># Target                     ARCH        CPU         Board name          Vendor         SoC         Options</span></span><br><span class="line">41 <span class="comment">###########################################################################################################</span></span><br><span class="line"></span><br><span class="line">284 origen                       arm         armv7       origen              samsung        exynos</span><br><span class="line">285 fs4412                       arm         armv7       fs4412              samsung        exynos</span><br></pre></td></tr></tbody></table></figure>

<p>重新编译：烧写到emmc启动开发板，</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">make distclean//清除原有的配置文件和生产的文件</span><br><span class="line">make fs4412_config//添加现有板子的配置文件</span><br><span class="line">make //编译uboot -&gt;生产u-boot.bin</span><br><span class="line"><span class="built_in">cp</span> u-boot.bin /tftpboot//将生成的u-boot.bin拷贝到tftp共享文件中；</span><br></pre></td></tr></tbody></table></figure>

<p>将拨码开关拨到100x SD启动</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">tftp 41000000 u-boot.bin	//在目标机上下载u-boot到41000000</span><br><span class="line">movi write u-boot 41000000	//将41000000地址空间的数据写入到uboot对应的位置</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>将拨码开关拨到011x emmc启动<br>观察现象：串口没有数据输出，板子没有任何反应；（板砖）</p>
</blockquote>
<blockquote>
<p>分析原因：uboot是否执行：<br>解决办法： 通过点灯的方式验证uboot是否执行</p>
</blockquote>
<p>2、在 arch/arm/cpu/armv7/start.S 文件中添加点灯代码：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">   /* led on */</span><br><span class="line">   ldr r0, =0x11000c40 @GPK2_7 led2</span><br><span class="line">   ldr r1, [r0]</span><br><span class="line">   bic r1, r1, #0xf0000000</span><br><span class="line">   orr r1, r1, #0x10000000</span><br><span class="line">   str r1, [r0]</span><br><span class="line">   </span><br><span class="line">ldr r0, =0x11000c44</span><br><span class="line">mov r1,#0xff</span><br><span class="line">str r1, [r0]</span><br></pre></td></tr></tbody></table></figure>

<p>重新编译：将uboot烧写到emmc，通过emmc启动开发板</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">make //编译uboot--&gt;生产u-boot.bin</span><br><span class="line"><span class="built_in">cp</span> u-boot.bin /tftpboot//将生成的u-boot.bin拷贝到tftp共享文件中；</span><br></pre></td></tr></tbody></table></figure>

<p>将拨码开关拨到100x SD启动</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">tftp 41000000 u-boot.bin//在目标机上下载u-boot到41000000</span><br><span class="line">movi write u-boot 41000000//将41000000地址空间的数据写入到uboot对应的位置</span><br></pre></td></tr></tbody></table></figure>

<p>串口没有数据输出，led并未被点亮；（板砖） –&gt; uboot并未被执行；<br>分析原因：与板子的启动有关系；</p>
<blockquote>
<p>解决办法：查看芯片手册，看启动流程,需要添加启动代码：BL1、BL2<br>1） 将CodeSign4SecureBoot 三星提供的安全启动方式拷贝uboot的目录中；<br>2）进入到CodeSign4SecureBoot目录中修改build.sh文件中cp对应行<br>cp u.bin /tftpboot </p>
<p>3）重新编译 执行build.sh<br>编译的同时将生产的u.bin拷贝到tftp共享文件中；<br>4）通过sd启动方式将uboot烧写到emmc<br>将拨码开关拨到100x SD启动<br>#tftp 41000000 u.bin//在目标机上下载u-boot到41000000<br>#movi write u-boot 41000000//将41000000地址空间的数据写入到uboot对应的位置</p>
</blockquote>
<ol start="3">
<li>通过emmc启动开发板<br>将拨码开关拨到011x emmc启动<br>观察现象：串口没有数据输出，led亮了，等一会灭了，又亮了，在等会led亮了，等一会灭了，又亮了 ……<br>分析原因：看门狗是否关闭、中断是否关闭、其它；<br>通过排除的方式，看门狗和中断没有问题，而是电源控制单元的问题<br>驱动电路过流或过热保护了。你这情况一般都是过热保护，驱动电路板散热不好，元件过热，电路就会自动断来，等温度降下来后，又再次启动。</li>
</ol>
<p>解决办法：添加电源管理相关代码，关闭看门狗</p>
<ol>
<li>代码修改<br> vim arch/arm/cpu/armv7/start.S中添加</li>
</ol>
  <figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">/*for close watchdog */    </span><br><span class="line"> /* PS-Hold high */</span><br><span class="line"> ldr r0, =0x1002330c    /*PS_HOLD_CONTROL*/</span><br><span class="line"> ldr r1, [r0]</span><br><span class="line"> orr r1, r1, #0x300</span><br><span class="line"> str r1, [r0]         </span><br><span class="line"> ldr     r0, =0x11000c08</span><br><span class="line"> ldr r1, =0x0             /*Disables Pull-up/Pull-down*/</span><br><span class="line"> str r1, [r0]</span><br><span class="line"> /* Clear  MASK_WDT_RESET_REQUEST  */</span><br><span class="line"> ldr r0, =0x1002040c</span><br><span class="line"> ldr r1, =0x00</span><br><span class="line"> str r1, [r0]</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li><p>重新编译：<br> cd CodeSign4SecureBoot<br> ./build.sh<br> –&gt; 生成的u.bin文件存储在tftp共享文件中</p>
</li>
<li><p>通过sd启动方式将uboot烧写到emmc<br> 将拨码开关拨到100x SD启动<br> #tftp 41000000 u.bin//在目标机上下载u-boot到41000000<br> #movi write u-boot 41000000//将41000000地址空间的数据写入到uboot对应的位置</p>
</li>
<li><p>通过emmc启动开发板<br> 将拨码开关拨到011x emmc启动</p>
</li>
</ol>
<p>重新观察结果： led常亮(说明uboot正常执行)，但是串口依然没有数据输出；<br>分析原因：串口初始化有问题，通过代码跟踪（串口时钟初始化的问题）；<br>解决办法：</p>
<ol>
<li>添加串口时钟初始化代码：board/samsung/fs4412/lowlevel_init.S<br> vim board/samsung/fs4412/lowlevel_init.S</li>
</ol>
<p>  在串口初始化代码中的<br>  str     r1, [r0, #EXYNOS4_GPIO_A1_CON_OFFSET]<br>  后面添加</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">     /* 添加串口相关的时钟初始化 */</span><br><span class="line">ldr     r0, =EXYNOS4_CLOCK_BASE      /*system_clock_init*/</span><br><span class="line">ldr     r1, =CLK_SRC_PERIL0_VAL /*uart[0:4]*/</span><br><span class="line">ldr     r2, =CLK_SRC_PERIL0_OFFSET</span><br><span class="line">str     r1, [r0, r2]</span><br><span class="line"></span><br><span class="line">ldr     r1, =CLK_DIV_PERIL0_VAL /*uart clock divisors*/</span><br><span class="line">ldr     r2, =CLK_DIV_PERIL0_OFFSET</span><br><span class="line">str     r1, [r0, r2]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>并且把串口初始化后面的</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">#if 0</span><br><span class="line">bl tzpc_init </span><br><span class="line">#endif</span><br></pre></td></tr></tbody></table></figure>


<p>屏蔽掉</p>
<ol start="2">
<li><p>重新编译：<br>cd CodeSign4SecureBoot<br>./build.sh<br>–&gt; 生成的u.bin文件存储在tftp共享文件中</p>
</li>
<li><p>通过sd启动方式将uboot烧写到emmc<br>将拨码开关拨到100x SD启动</p>
</li>
</ol>
<p>#tftp 41000000 u.bin//在目标机上下载u-boot到41000000<br>#movi write u-boot 41000000//将41000000地址空间的数据写入到uboot对应的位置<br>4) 通过emmc启动开发板<br>将拨码开关拨到011x SD启动</p>
<h3 id="内核移植"><a href="#内核移植" class="headerlink" title="内核移植"></a>内核移植</h3><h4 id="一、-内核准备："><a href="#一、-内核准备：" class="headerlink" title="一、 内核准备："></a>一、 内核准备：</h4><ol>
<li><p>内核源代码准<br> 1）官网下载Linux内核源代码<br> 2）找供应商要（得到Linux内核源代码：linux-3.14.tar.xz）</p>
</li>
<li><p>拷贝源代码到工作目录：<br> cp linux-3.14.tar.xz </p>
</li>
<li><p>进入Linux内核源代码所在目录，解压Linux内核源代码<br> cd<br> tar xf linux-3.14.tar.xz</p>
</li>
<li><p>进入到源代码目录中<br> cd linux-3.14</p>
</li>
</ol>
<h4 id="二、-内核编译："><a href="#二、-内核编译：" class="headerlink" title="二、 内核编译："></a>二、 内核编译：</h4><ol start="5">
<li><p>修改编译平台和交叉编译环境<br> 进入Makefile文件，修改参数：<br> 修改：<br>199 ARCH		?= $(SUBARCH)<br>200 CROSS_COMPILE	?= $(CONFIG_CROSS_COMPILE:”%”=%)<br> 为：<br>199 ARCH            ?= arm<br>200 CROSS_COMPILE   ?= arm-none-linux-gnueabi-</p>
</li>
<li><p>导入默认配置，配置文件放在 arch/arm/configs下<br> make exynos_defconfig</p>
</li>
<li><p>配置内核<br> make menuconfig<br> 正常执行，会弹出一个菜单选项，我们可以去选择需要配置的内核；<br> 注意：<br> (如果在编译的时候出现了下面的错误，则说明图形界面库没有安装，需要安装库</p>
<p>   sudo apt-get install exuberant-ctags<br>   sudo apt-get install libncurses5-dev</p>
</li>
</ol>
<p>  )</p>
<blockquote>
<p>*** Unable to find the ncurses libraries or the<br> *** required header files.<br> *** ‘make menuconfig’ requires the ncurses libraries.</p>
<p> *** Install ncurses (ncurses-devel) and try again.</p>
<p>make[1]: *** [scripts/kconfig/dochecklxdialog] Error 1<br>make: *** [menuconfig] Error 2</p>
<p>第二种：<br>farsight@ubuntu:~/fs4412/1905/linux-3.14$ make menuconfig<br>scripts/kconfig/mconf Kconfig<br>Your display is too small to run Menuconfig!<br>It must be at least 19 lines by 80 columns.<br>make[1]: *** [menuconfig] Error 1<br>make: *** [menuconfig] Error 2</p>
<p>表示终端太小，全屏显示就可以解决</p>
<pre><code>正常执行菜单选项，选择串口信息：
/* 将串口选择为 2  */
System Type  ---&gt;
    (2) S3C UART to use for low-level messages
</code></pre>
</blockquote>
<ol start="8">
<li>编译内核<br> make uImage<br> 编译成功会生成一个经过压缩后的镜像文件uImage，其生成的文件路径为：arch/arm/boot/uImage<br> 注意：(如果在编译的时候出现了下面的错误，则说明缺少mkimage工具，<br> 需将第一天工具中的mkimage拷贝到ubuntu的/usr/bin目录下)<br> “mkimage” command not found - U-Boot images will not be built<br> make[1]: *** [arch/arm/boot/uImage] Error 1<br> make: *** [uImage] Error 2</li>
</ol>
<h4 id="三、设备树编译："><a href="#三、设备树编译：" class="headerlink" title="三、设备树编译："></a>三、设备树编译：</h4><ol start="9">
<li><p>修改设备树文件<br> 参考板origen的设备数文件为参考：<br> cp arch/arm/boot/dts/exynos4412-origen.dts arch/arm/boot/dts/exynos4412-fs4412.dts</p>
</li>
<li><p>修改Makefile，添加编译项：<br>vim arch/arm/boot/dts/Makefile<br>在<br>exynos4412-origen.dtb <br>下添加如下内容<br>exynos4412-fs4412.dtb \</p>
</li>
<li><p>编译设备树文件：<br>make dtbs</p>
</li>
<li><p>拷贝编译的内核和设备树到tftp共享文件中<br>cp arch/arm/boot/uImage /tftpboot<br>cp arch/arm/boot/dts/exynos4412-fs4412.dtb /tftpboot</p>
</li>
</ol>
<h4 id="四、调试内核和设备树；"><a href="#四、调试内核和设备树；" class="headerlink" title="四、调试内核和设备树；"></a>四、调试内核和设备树；</h4><p>采用tftp下载内核和设备树，nfs挂载根文件系统<br>    set tftp 41000000 uImage; tftp 42000000 exynos4412-fs4412.dtb; bootm 41000000 - 42000000<br>    set bootargs root=/dev/nfs nfsroot=192.168.12.135:/source/nfs/rootfs rw clk_ignore_unused console=ttySAC2,115200 init=/linuxrc ip=192.168.12.133</p>
<p>set bootargs root=/dev/nfs nfsroot=192.168.12.135:/home/yzy/rootfs/ rw clk_ignore_unused console=ttySAC2,115200 init=/linuxrc ip=192.168.12.133</p>
<p>​	saveenv<br>掉电重启板子  //会看到内核信息输出。 但后面有报错，正常 （因为网卡等还没移植，nfs挂载肯定失败）</p>
<h4 id="【网卡驱动的移植】"><a href="#【网卡驱动的移植】" class="headerlink" title="【网卡驱动的移植】"></a>【网卡驱动的移植】</h4><ol>
<li>修改设备树文件</li>
</ol>
<p>添加：linux-3.14/arch/arm/boot/dts/exynos4412-fs4412.dts</p>
<pre><code>    srom-cs1@5000000 {
        compatible = "simple-bus";
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;1&gt;;
        reg = &lt;0x5000000 0x1000000&gt;;
        ranges;
        
        ethernet@5000000 {
        compatible = "davicom,dm9000";
        reg = &lt;0x5000000 0x2 0x5000004 0x2&gt;;
        interrupt-parent = &lt;&amp;gpx0&gt;;
        interrupts = &lt;6 4&gt;;
        davicom,no-eeprom;
        mac-address = [00 0a 2d a6 55 a2];
    };
};
</code></pre>
<p>添加设备编译参数<br>make menuconfig</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">[*] Networking support  ---&gt;    //配置支持TCP/IP</span><br><span class="line">	Networking options  ---&gt;</span><br><span class="line">		&lt;*&gt; Packet socket</span><br><span class="line">		&lt;*&gt;Unix domain sockets </span><br><span class="line">		[*] TCP/IP networking</span><br><span class="line">		[*]   IP: kernel level autoconfiguration</span><br><span class="line">Device Drivers  ---&gt;   //配置支持DM9000网卡驱动</span><br><span class="line">	[*] Network device support  ---&gt;</span><br><span class="line">		[*]   Ethernet driver support (NEW)  ---&gt;</span><br><span class="line">			&lt;*&gt;   DM9000 support</span><br><span class="line">File systems  ---&gt;  //配置支持网络文件系统NFS</span><br><span class="line">	[*] Network File Systems (NEW)  ---&gt;</span><br><span class="line">		&lt;*&gt;   NFS client support</span><br><span class="line">		[*]     NFS client support <span class="keyword">for</span> NFS version 2</span><br><span class="line">		[*]     NFS client support <span class="keyword">for</span> NFS version 3</span><br><span class="line">		[*]       NFS client support <span class="keyword">for</span> the NFSv3 ACL protocol extension</span><br><span class="line">		[*]   Root file system on NFS</span><br></pre></td></tr></tbody></table></figure>

<p>重新编译内核和设备树<br>    make uImage<br>    make dtbs<br>将编译好的内核和设备树拷贝到tftp共享目录中<br>    cp arch/arm/boot/uImage /tftpboot<br>    cp arch/arm/boot/dts/exynos4412-fs4412.dtb /tftpboot<br>采用tftp下载内核和设备树，nfs挂载根文件系统<br>    set tftp 41000000 uImage; tftp 42000000 exynos4412-fs4412.dtb; bootm 41000000 - 42000000<br>    set bootargs root=/dev/nfs nfsroot=192.168.1.190:/source/nfs/rootfs rw clk_ignore_unused console=ttySAC2,115200 init=/linuxrc ip=192.168.1.191</p>
<p>如果挂载失败：修改文件drivers/clk/clk.c<br>    修改static bool clk_ignore_unused; 为：static bool clk_ignore_unused = true;    //忽略时钟</p>
<h4 id="【LED灯的移植】"><a href="#【LED灯的移植】" class="headerlink" title="【LED灯的移植】"></a>【LED灯的移植】</h4><p>把驱动fs4412_led_drv.c 放置在drivers/char目录下<br>第一种：<br>{<br>    $ vim  drivers/char/Makefile /* 把驱动加入编译列表中<br>       在末尾添加 obj-y += fs4412_led_drv.o<br>       */</p>
<p>  $ make uImage<br>  $ cp arch/arm/boot/uImage  /tftpboot<br>}</p>
<p>{第二种：<br>    $ vim  drivers/char/Makefile /* 把驱动加入编译列表中<br>       在末尾添加 obj-$(CONFIG_FS4412_LED) += fs4412_led_drv.o<br>       */</p>
<pre><code>$ vim  drivers/char/Kconfig  /* 增加驱动的菜单配置选项（make menuconfig时能看到）
  在menu "Character devices"下面 添加
   config FS4412_LED
            bool "FS4412LED Device Support"       //bool--表示是否加载入内核
            depends on ARCH_EXYNOS4
          help
                  support  led device on FS4412 develop board
   */
</code></pre>
<p>  $ make menuconfig  /* 配置编译驱动进内核<br>        Device Drivers  —&gt;<br>                Character devices  —&gt;<br>                    [*]FS4412  LED Device Support<br>     */</p>
<p>  $ make uImage<br>  $ cp arch/arm/boot/uImage  /tftpboot<br>}	</p>
<p>  //—测试驱动<br>  $ arm-none-linux-gnueabi-gcc  fs4412_led_app.c   //编译用于测试驱动的应用程序,默认编译会生成 a.out<br>  $ cp a.out /source/nfs/rootfs	<br>  重启板子,进入根文件系统</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mknod</span> /dev/led  c  500  0  /*创建设备节点</span><br><span class="line">    <span class="built_in">mknod</span>     专门用于创建设备节点的命令</span><br><span class="line">    /dev/led  是设备文件名</span><br><span class="line">    c         表示是字符设备</span><br><span class="line">    500       主设备号 </span><br><span class="line">    0         次设备号</span><br><span class="line">*/</span><br></pre></td></tr></tbody></table></figure>



<p>./a.out  //运行测试程序， 会看到灯闪烁</p>
<h3 id="根文件系统移植"><a href="#根文件系统移植" class="headerlink" title="根文件系统移植"></a>根文件系统移植</h3><h4 id="安装-BusyBox"><a href="#安装-BusyBox" class="headerlink" title="安装 BusyBox"></a>安装 BusyBox</h4><ol>
<li>将busybox-1.22.1.tar.bz2拷贝到你需要操作的目录<br> cp busybox-1.22.1.tar.bz2 /home/farsight/workpace/fs4412</li>
<li>解压busybox-1.22.1.tar.bz2<br> tar xf busybox-1.22.1.tar.bz2</li>
<li>进入到busybox目录中<br> cd busybox-1.22.1</li>
<li>配置编译信息<br> make menuconfig		//弹出图像界面<br> Busybox Settings  —&gt; 		//设置busybox<br> Build Options  —&gt; 	//编译选项<br>     [*] Build BusyBox as a static binary (no shared libs)	//采用静态编译<br>     (arm-linux-) Cross Compiler prefix		//采用的编译器是arm-linux-<br> Installation Options (“make install” behavior)  —&gt;	//设置安装路径<br>     (./rootfs) BusyBox installation prefix	//设置安装路径为./rootfs,如果采用默认路径为./_install</li>
<li>编译busybox<br> make</li>
<li>安装busybox<br> make install</li>
<li>替换共享目录<br> rm -r /source/nfs/rootfs<br> cp -r rootfs /source/nfs</li>
</ol>
<p>启动开发板，观察现象：<br>此时的文件系统能够启动，但是缺少文件；</p>
<h4 id="创建缺少的目录"><a href="#创建缺少的目录" class="headerlink" title="创建缺少的目录"></a>创建缺少的目录</h4><p>mkdir etc dev tmp mnt proc sys var lib</p>
<h4 id="添加所需要的库代码"><a href="#添加所需要的库代码" class="headerlink" title="添加所需要的库代码"></a>添加所需要的库代码</h4><p>sudo cp -a /home/farsight/gcc-4.6.4/arm-arm1176jzfssf-linux-gnueabi/lib/* ./lib/      */<br>进入lib目录删除无用的库，用来保证rootfs足够小，但是要功能的实训；<br>sudo rm *.a<br>sudo chmod 0777 *<br>arm-none-linux-gnueabi-strip *</p>
<h4 id="sudo-mknod-dev-x2F-console-c-5-1"><a href="#sudo-mknod-dev-x2F-console-c-5-1" class="headerlink" title="sudo mknod dev/console c 5 1"></a>sudo mknod dev/console c 5 1</h4><h4 id="添加启动配置信息"><a href="#添加启动配置信息" class="headerlink" title="添加启动配置信息 {"></a>添加启动配置信息 {</h4><p>1)/etc/init.d/rcS<br>    #!/bin/sh<br>    # This is the first script called by init process<br>    /bin/mount  -a<br>    echo  /sbin/mdev  &gt;  /proc/sys/kernel/hotplug<br>    /sbin/mdev  -s</p>
<ol start="2">
<li><p>/etc/inittab<br> #this is run first except when booting in single-user mode.<br> ::sysinit:/etc/init.d/rcS</p>
<p> /bin/sh invocations on selected ttys</p>
<p> start an “askfirst” shell on the console (whatever that may be)</p>
<p> ::askfirst:-/bin/sh</p>
<p> stuff to do when restarting the init process</p>
<p> ::restart:/sbin/init</p>
<p> stuff to do before rebooting</p>
<p> ::ctrlaltdel:/sbin/reboot</p>
</li>
<li><p>/etc/fstab<br> #device     mount-point         type            options         dump     fsck order<br> proc    /proc                   proc            defaults                0               0<br> tmpfs   /tmp                    tmpfs           defaults                0               0<br> sysfs   /sys                    sysfs           defaults                0               0<br> tmpfs   /dev                    tmpfs           defaults                0               0</p>
</li>
<li><p>/etc/profile<br> LD_LIBRARY_PATH=/lib:/usr/lib<br> export LD_LIBRARY_PAHT<br> PATH=/bin:/sbin:/usr/bin:/usr:/sbin<br> export PATH<br> export HOSTNAME=Farsight<br> export USER=root<br> export HOME=root<br> export PS1=”[$USER@$HOSTNAME:\W]# “</p>
<p> export QTDIR=/usr/local/Trolltech/QtEmbedded-4.8.6-arm<br> export LD_LIBRARY_PATH=$QTDIR/lib:$LD_LIBRARY_PATH<br> export PATH=$QTDIR/bin:$PATH<br> export QWS_SIZE=”1024x600”<br> export QT_QWS_FONTDIR=$QTDIR/lib/fonts</p>
</li>
</ol>
<p>如果根文件系统需要烧写flash里面，需要去制作镜像文件；<br>制作ramdisk.img<br>   $ cd ~<br>   $ dd if=/dev/zero of=initrd.img bs=1k count=8192  //创建一个8M的空磁盘， 表示把/dev/zero中数据读到initrd.img   if–表示输入设备  of–输出  bs–单元  count–数目<br>   $ mkfs.ext2 -F initrd.img         //把initrd.img制作成ext2格式的文件<br>   $ mount  -t  ext2   -o  loop  initrd.img  /mnt/     //把initrd.img挂载到/mnt/  设备需要挂载后才能拷贝<br>        //如果报错：cp: writing `/mnt/rootfs/lib/libBrokenLocale-2.17.so’: No space left on device<br>        //说明根文件太大，需要裁剪一部分<br>   $ cp /nfs/rootfs/* /mnt/ -a                     */    //把文件系统拷贝到/mnt中，也就是initrd.img中<br>   $ umount /mnt/<br>   $ gzip  –best  -c  initrd.img  &gt;  initrd.img.gz  //压缩之前，确认已umount ,避免数据正被使用，压缩出错<br>   $ mkimage -n “ramdisk” -A arm -O linux -T ramdisk -C gzip -d initrd.img.gz ramdisk.img   //把根文件系统制作成u-boot能识别的格式<br>   $ cp  ramdisk.img  /tftpboot</p>
<p>   //注意验证根文件系统时，使用的是第一天共享的完全OK的内核<br>   #setenv bootcmd tftp 41000000 uImage;tftp 42000000 exynos4412-fs4412.dtb;tftp 43000000  ramdisk.img;bootm 41000000 43000000 42000000   /* </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://miaobuyi.github.io">miaobuyi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://miaobuyi.github.io/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E5%AE%9E%E6%93%8D/">https://miaobuyi.github.io/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E5%AE%9E%E6%93%8D/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://miaobuyi.github.io" target="_blank">miaobuyi</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://imgapi.xl0408.top/index.php" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/30/%E7%BD%91%E7%BB%9C%E7%A7%BB%E6%A4%8D/" title="网络移植"><img class="cover" src="https://imgapi.xl0408.top/index.php" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">网络移植</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/" title="系统移植"><img class="cover" src="https://imgapi.xl0408.top/index.php" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">系统移植</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://typora-1307795383.cos.ap-chengdu.myqcloud.com/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">miaobuyi</div><div class="author-info__description">人类的悲欢并不相通</br>我只觉得他们吵闹</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/miaobuyi"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/miaobuyi" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2426012846@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D"><span class="toc-text">系统移植</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E7%B3%BB%E7%BB%9F%EF%BC%9A%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F%EF%BC%88BootLoader%EF%BC%89%E3%80%81%E5%86%85%E6%A0%B8%EF%BC%88kernel%EF%BC%89-%E8%AE%BE%E5%A4%87%E6%A0%91-dtb-%E3%80%81%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%88rootfs%EF%BC%89"><span class="toc-text">linux系统：引导程序（BootLoader）、内核（kernel）+ 设备树(dtb)、根文件系统（rootfs）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E5%92%8Cwindow%E9%97%B4%E5%85%B1%E4%BA%AB"><span class="toc-text">linux和window间共享</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="toc-text">网络的建立</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E7%94%B5%E8%84%91%E5%92%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%97%B6%E8%83%BD%E9%80%9A%E4%BF%A1"><span class="toc-text">确认电脑和虚拟机时能通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E3%80%90%E5%AE%BF%E4%B8%BB%E6%9C%BA%E3%80%91%E7%9A%84IP%E5%9C%B0%E5%9D%80%EF%BC%9A%E4%B9%9F%E5%B0%B1%E6%98%AFpc%E6%9C%BA%E7%9A%84ip%E5%9C%B0%E5%9D%80-192-168-9-100-%EF%BC%9B"><span class="toc-text">设置【宿主机】的IP地址：也就是pc机的ip地址 192.168.9.100 ；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E6%98%AF%E5%90%A6%E5%BB%BA%E7%AB%8B%E5%A5%BD%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%EF%BC%9A"><span class="toc-text">确认是否建立好网络通信：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9A%84%E4%BC%A0%E8%BE%93"><span class="toc-text">文件的传输</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEtftp%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">配置tftp服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8tftp%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">启动tftp服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E7%9B%AE%E6%A0%87%E6%9C%BA%E3%80%91%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-text">【目标机】下载文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%99%A8%E5%AE%89%E8%A3%85"><span class="toc-text">交叉编译器安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nfs%E6%8C%82%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-text">nfs挂载文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E5%BC%80%E5%8F%91%E4%B8%BB%E6%9C%BA%E3%80%91"><span class="toc-text">【开发主机】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E7%9B%AE%E6%A0%87%E6%9C%BA%E3%80%91"><span class="toc-text">【目标机】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E3%80%91"><span class="toc-text">【问题解决】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BootLoader-%E7%A7%BB%E6%A4%8D"><span class="toc-text">BootLoader 移植</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E7%A7%BB%E6%A4%8D%E6%96%B9%E6%B3%95%E3%80%91"><span class="toc-text">【移植方法】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E7%9B%AE%E7%9A%84%E3%80%91"><span class="toc-text">【目的】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E5%87%86%E5%A4%87%E8%B5%84%E6%96%99%E3%80%91"><span class="toc-text">【准备资料】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E5%88%86%E6%9E%90%E3%80%91"><span class="toc-text">【分析】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E7%A7%BB%E6%A4%8D"><span class="toc-text">内核移植</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E5%86%85%E6%A0%B8%E5%87%86%E5%A4%87%EF%BC%9A"><span class="toc-text">一、 内核准备：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%EF%BC%9A"><span class="toc-text">二、 内核编译：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%AE%BE%E5%A4%87%E6%A0%91%E7%BC%96%E8%AF%91%EF%BC%9A"><span class="toc-text">三、设备树编译：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%B0%83%E8%AF%95%E5%86%85%E6%A0%B8%E5%92%8C%E8%AE%BE%E5%A4%87%E6%A0%91%EF%BC%9B"><span class="toc-text">四、调试内核和设备树；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90%E7%BD%91%E5%8D%A1%E9%A9%B1%E5%8A%A8%E7%9A%84%E7%A7%BB%E6%A4%8D%E3%80%91"><span class="toc-text">【网卡驱动的移植】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%80%90LED%E7%81%AF%E7%9A%84%E7%A7%BB%E6%A4%8D%E3%80%91"><span class="toc-text">【LED灯的移植】</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D"><span class="toc-text">根文件系统移植</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-BusyBox"><span class="toc-text">安装 BusyBox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BC%BA%E5%B0%91%E7%9A%84%E7%9B%AE%E5%BD%95"><span class="toc-text">创建缺少的目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E5%BA%93%E4%BB%A3%E7%A0%81"><span class="toc-text">添加所需要的库代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sudo-mknod-dev-x2F-console-c-5-1"><span class="toc-text">sudo mknod dev&#x2F;console c 5 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-text">添加启动配置信息 {</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式"><img src="https://api.yimian.xyz/img" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式"/></a><div class="content"><a class="title" href="/2023/06/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式">设计模式</a><time datetime="2023-06-08T10:44:33.000Z" title="发表于 2023-06-08 18:44:33">2023-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/30/MMC%E7%A7%BB%E6%A4%8D/" title="MMC移植"><img src="https://imgapi.xl0408.top/index.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MMC移植"/></a><div class="content"><a class="title" href="/2023/05/30/MMC%E7%A7%BB%E6%A4%8D/" title="MMC移植">MMC移植</a><time datetime="2023-05-30T11:44:37.000Z" title="发表于 2023-05-30 19:44:37">2023-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/30/%E7%BD%91%E7%BB%9C%E7%A7%BB%E6%A4%8D/" title="网络移植"><img src="https://imgapi.xl0408.top/index.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络移植"/></a><div class="content"><a class="title" href="/2023/05/30/%E7%BD%91%E7%BB%9C%E7%A7%BB%E6%A4%8D/" title="网络移植">网络移植</a><time datetime="2023-05-30T11:44:13.000Z" title="发表于 2023-05-30 19:44:13">2023-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E5%AE%9E%E6%93%8D/" title="系统移植实操"><img src="https://imgapi.xl0408.top/index.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="系统移植实操"/></a><div class="content"><a class="title" href="/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E5%AE%9E%E6%93%8D/" title="系统移植实操">系统移植实操</a><time datetime="2023-05-29T11:40:16.000Z" title="发表于 2023-05-29 19:40:16">2023-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/" title="系统移植"><img src="https://imgapi.xl0408.top/index.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="系统移植"/></a><div class="content"><a class="title" href="/2023/05/29/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/" title="系统移植">系统移植</a><time datetime="2023-05-29T09:19:43.000Z" title="发表于 2023-05-29 17:19:43">2023-05-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://imgapi.xl0408.top/index.php')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By miaobuyi</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><div class="aplayer no-destroy" data-id="5463524537" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><script defer src="https://rmt.dogedoge.com/fetch/~/source/jsdelivr/npm/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="https://cdn.jsdelivr.net/gh/sirxemic/jquery.ripples/dist/jquery.ripples.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><!-- hexo injector body_end start --><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1s');
    arr[i].setAttribute('data-wow-delay', '0ms');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>